import{l as t,u as a,a as e,m as n,s as o,e as s,y as r}from"../index.fdbf5207.js";import{f as c,c as l,d as i,g as u}from"./article.1c822bd2.js";import{a as m,b as d}from"./profile.9d5657be.js";import{D as p}from"./constants.74db8a6c.js";import{L as g}from"./LoadingIndicator.9657de37.js";const h={"":["<em>","</em>"],_:["<strong>","</strong>"],"*":["<strong>","</strong>"],"~":["<s>","</s>"],"\n":["<br />"]," ":["<br />"],"-":["<hr />"]};function $(t){return t.replace(RegExp("^"+(t.match(/^(\t| )+/)||"")[0],"gm"),"")}function f(t){return(t+"").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function v(t,a){let e,n,o,s,r,c=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,l=[],i="",u=a||{},m=0;function d(t){let a=h[t[1]||""],e=l[l.length-1]==t;return a?a[1]?(e?l.pop():l.push(t),a[0|e]):a[0]:t}function p(){let t="";for(;l.length;)t+=d(l[l.length-1]);return t}for(t=t.replace(/^\[(.+?)\]:\s*(.+)$/gm,(t,a,e)=>(u[a.toLowerCase()]=e,"")).replace(/^\n+|\n+$/g,"");o=c.exec(t);)n=t.substring(m,o.index),m=c.lastIndex,e=o[0],n.match(/[^\\](\\\\)*\\$/)||((r=o[3]||o[4])?e='<pre class="code '+(o[4]?"poetry":o[2].toLowerCase())+'"><code'+(o[2]?` class="language-${o[2].toLowerCase()}"`:"")+">"+$(f(r).replace(/^\n+|\n+$/g,""))+"</code></pre>":(r=o[6])?(r.match(/\./)&&(o[5]=o[5].replace(/^\d+/gm,"")),s=v($(o[5].replace(/^\s*[>*+.-]/gm,""))),">"==r?r="blockquote":(r=r.match(/\./)?"ol":"ul",s=s.replace(/^(.*)(\n|$)/gm,"<li>$1</li>")),e="<"+r+">"+s+"</"+r+">"):o[8]?e=`<img src="${f(o[8])}" alt="${f(o[7])}">`:o[10]?(i=i.replace("<a>",`<a href="${f(o[11]||u[n.toLowerCase()])}">`),e=p()+"</a>"):o[9]?e="<a>":o[12]||o[14]?(r="h"+(o[14]?o[14].length:o[13]>"="?1:2),e="<"+r+">"+v(o[12]||o[15],u)+"</"+r+">"):o[16]?e="<code>"+f(o[16])+"</code>":(o[17]||o[1])&&(e=d(o[17]||"--"))),i+=n,i+=e;return(i+t.substring(m)+p()).replace(/^\n+|\n+$/g,"")}const b=t=>new Date(t).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"});function w(o){const[s,r]=t(o.article),u=a(t=>t.user),g=e();return n`<div class="article-meta"><a href=${"/@"+s.author.username}><img src=${s.author.image||p} alt="User's profile picture"/></a><div class="info"><a href=${"/@"+s.author.username} class="author">${s.author.username}</a><span class="date">${b(s.createdAt)}</span></div>${function(t){let a=void 0,e=t[0],n=1;for(;n<t.length;){const o=t[n],s=t[n+1];if(n+=2,("optionalAccess"===o||"optionalCall"===o)&&null==e)return;"access"===o||"optionalAccess"===o?(a=e,e=s(e)):"call"!==o&&"optionalCall"!==o||(e=s((...t)=>e.call(a,...t)),a=void 0)}return e}([u,"optionalAccess",t=>t.username])===s.author.username?n`<a class="btn btn-sm btn-outline-secondary" href=${"/editor/"+s.slug}><i class="ion-edit"/> Edit Article</a><button class="btn btn-sm btn-outline-danger" onClick=${async()=>{await c(s.slug),g.route("/")}}><i class="ion-trash-a"/> Delete Article</button>`:n`<button class=${"btn btn-sm "+(s.author.following?"btn-secondary":"btn-outline-secondary")} onClick=${async()=>{const t=s.author.following?await m(s.author.username):await d(s.author.username);r({...s,author:t})}}><i class="ion-plus-round"/> ${s.author.following?"Unfollow":"Follow"} ${s.author.username}</button><button class=${"btn btn-sm "+(s.favorited?"btn-primary":"btn-outline-primary")} onClick=${async()=>r(s.favorited?await l(s.slug):await i(s.slug))}><i class="ion-heart"/>Favorite Article <span class="counter">(${s.favoritesCount})</span></button>`}</div>`}function y(t){const{comment:e}=t,r=a(t=>t.user);return n`<div class="card"><div class="card-block"><p class="card-text">${e.body}</p></div><div class="card-footer"><a href=${"/@"+e.author.username} class="comment-author"><img src=${e.author.image||p} class="comment-author-img" alt="User's profile picture"/></a><a href=${"/@"+e.author.username} class="comment-author">${e.author.username}</a><span class="date-posted">${b(e.createdAt)}</span><span class="mod-options">${function(t){let a=void 0,e=t[0],n=1;for(;n<t.length;){const o=t[n],s=t[n+1];if(n+=2,("optionalAccess"===o||"optionalCall"===o)&&null==e)return;"access"===o||"optionalAccess"===o?(a=e,e=s(e)):"call"!==o&&"optionalCall"!==o||(e=s((...t)=>e.call(a,...t)),a=void 0)}return e}([r,"optionalAccess",t=>t.username])===e.author.username&&n`<i class="ion-trash-a" onClick=${async()=>{await async function(t,a){try{await o.delete(`articles/${t}/comments/${a}`)}catch(e){throw s(e,"error while deleting comment")}}(t.articleSlug,e.id),t.onDelete()}} aria-label="Delete comment"/>`}</span></div></div>`}export default function(e){const[c,l]=t(void 0),[i,m]=t([]),[d,h]=t(""),[$,f]=t(!1),b=a(t=>t.user);return r(()=>{!async function(){f(!0),l(await u(e.slug)),m(await async function(t){try{const{data:a}=await o.get(`articles/${t}/comments`);return a.comments}catch(a){throw s(a,"error while fetching comments")}}(e.slug)),f(!1)}()},[e.slug]),c?n`<div class="article-page"><div class="banner"><div class="container"><h1>${c.title}</h1><${w} article=${c}/></div></div><div class="container page"><div class="row article-content"><div class="col-xs-12" dangerouslySetInnerHTML=${{__html:v(c.body)}}/></div><hr/><div class="article-actions"><${w} article=${c}/></div><div class="row"><div class="col-xs-12 col-md-8 offset-md-2"><form class="card comment-form"><div class="card-block"><textarea value=${d} class="form-control" placeholder="Write a comment..." rows=${3} onInput=${t=>h(t.currentTarget.value)}/></div><div class="card-footer"><img src=${function(t){let a=void 0,e=t[0],n=1;for(;n<t.length;){const o=t[n],s=t[n+1];if(n+=2,("optionalAccess"===o||"optionalCall"===o)&&null==e)return;"access"===o||"optionalAccess"===o?(a=e,e=s(e)):"call"!==o&&"optionalCall"!==o||(e=s((...t)=>e.call(a,...t)),a=void 0)}return e}([b,"optionalAccess",t=>t.image])||p} class="comment-author-img"/><button class="btn btn-sm btn-primary" onClick=${async()=>{const t=await async function(t,a){try{const{data:e}=await o.post(`articles/${t}/comments`,{comment:{body:a}});return e.comment}catch(e){throw s(e,"error while creating comment")}}(e.slug,d);h(""),m(a=>[t,...a])}}>Post Comment</button></div></form>${i.map(t=>n`<${y} key=${t.id} articleSlug=${e.slug} comment=${t} onDelete=${()=>m(a=>a.filter(a=>a.id!==t.id))}/>`)}</div></div></div></div>`:n`<${g} show=${$} style=${{margin:"1rem auto",display:"flex"}} width="2em"/>`}