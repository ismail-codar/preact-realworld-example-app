import{l as t,u as a,b as e,m as n,D as o,c as s,d as r,e as c,f as l,g as i,y as u,h as m,a as d}from"../index.a1bc8b39.js";import{a as g,b as p}from"./profile.2dc205f6.js";const h={"":["<em>","</em>"],_:["<strong>","</strong>"],"*":["<strong>","</strong>"],"~":["<s>","</s>"],"\n":["<br />"]," ":["<br />"],"-":["<hr />"]};function $(t){return t.replace(RegExp("^"+(t.match(/^(\t| )+/)||"")[0],"gm"),"")}function f(t){return(t+"").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function v(t,a){let e,n,o,s,r,c=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,l=[],i="",u=a||{},m=0;function d(t){let a=h[t[1]||""],e=l[l.length-1]==t;return a?a[1]?(e?l.pop():l.push(t),a[0|e]):a[0]:t}function g(){let t="";for(;l.length;)t+=d(l[l.length-1]);return t}for(t=t.replace(/^\[(.+?)\]:\s*(.+)$/gm,(t,a,e)=>(u[a.toLowerCase()]=e,"")).replace(/^\n+|\n+$/g,"");o=c.exec(t);)n=t.substring(m,o.index),m=c.lastIndex,e=o[0],n.match(/[^\\](\\\\)*\\$/)||((r=o[3]||o[4])?e='<pre class="code '+(o[4]?"poetry":o[2].toLowerCase())+'"><code'+(o[2]?` class="language-${o[2].toLowerCase()}"`:"")+">"+$(f(r).replace(/^\n+|\n+$/g,""))+"</code></pre>":(r=o[6])?(r.match(/\./)&&(o[5]=o[5].replace(/^\d+/gm,"")),s=v($(o[5].replace(/^\s*[>*+.-]/gm,""))),">"==r?r="blockquote":(r=r.match(/\./)?"ol":"ul",s=s.replace(/^(.*)(\n|$)/gm,"<li>$1</li>")),e="<"+r+">"+s+"</"+r+">"):o[8]?e=`<img src="${f(o[8])}" alt="${f(o[7])}">`:o[10]?(i=i.replace("<a>",`<a href="${f(o[11]||u[n.toLowerCase()])}">`),e=g()+"</a>"):o[9]?e="<a>":o[12]||o[14]?(r="h"+(o[14]?o[14].length:o[13]>"="?1:2),e="<"+r+">"+v(o[12]||o[15],u)+"</"+r+">"):o[16]?e="<code>"+f(o[16])+"</code>":(o[17]||o[1])&&(e=d(o[17]||"--"))),i+=n,i+=e;return(i+t.substring(m)+g()).replace(/^\n+|\n+$/g,"")}const b=t=>new Date(t).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"});function w(l){const[i,u]=t(l.article),m=a(t=>t.user),d=e();return n`<div class="article-meta"><a href=${"/@"+i.author.username}><img src=${i.author.image||o} alt="User's profile picture"/></a><div class="info"><a href=${"/@"+i.author.username} class="author">${i.author.username}</a><span class="date">${b(i.createdAt)}</span></div>${function(t){let a=void 0,e=t[0],n=1;for(;n<t.length;){const o=t[n],s=t[n+1];if(n+=2,("optionalAccess"===o||"optionalCall"===o)&&null==e)return;"access"===o||"optionalAccess"===o?(a=e,e=s(e)):"call"!==o&&"optionalCall"!==o||(e=s((...t)=>e.call(a,...t)),a=void 0)}return e}([m,"optionalAccess",t=>t.username])===i.author.username?n`<a class="btn btn-sm btn-outline-secondary" href=${"/editor/"+i.slug}><i class="ion-edit"/> Edit Article</a><button class="btn btn-sm btn-outline-danger" onClick=${async()=>{await s(i.slug),d.route("/")}}><i class="ion-trash-a"/> Delete Article</button>`:n`<button class=${"btn btn-sm "+(i.author.following?"btn-secondary":"btn-outline-secondary")} onClick=${async()=>{const t=i.author.following?await g(i.author.username):await p(i.author.username);u({...i,author:t})}}><i class="ion-plus-round"/> ${i.author.following?"Unfollow":"Follow"} ${i.author.username}</button><button class=${"btn btn-sm "+(i.favorited?"btn-primary":"btn-outline-primary")} onClick=${async()=>u(i.favorited?await r(i.slug):await c(i.slug))}><i class="ion-heart"/>Favorite Article <span class="counter">(${i.favoritesCount})</span></button>`}</div>`}function y(t){const{comment:e}=t,s=a(t=>t.user);return n`<div class="card"><div class="card-block"><p class="card-text">${e.body}</p></div><div class="card-footer"><a href=${"/@"+e.author.username} class="comment-author"><img src=${e.author.image||o} class="comment-author-img" alt="User's profile picture"/></a><a href=${"/@"+e.author.username} class="comment-author">${e.author.username}</a><span class="date-posted">${b(e.createdAt)}</span><span class="mod-options">${function(t){let a=void 0,e=t[0],n=1;for(;n<t.length;){const o=t[n],s=t[n+1];if(n+=2,("optionalAccess"===o||"optionalCall"===o)&&null==e)return;"access"===o||"optionalAccess"===o?(a=e,e=s(e)):"call"!==o&&"optionalCall"!==o||(e=s((...t)=>e.call(a,...t)),a=void 0)}return e}([s,"optionalAccess",t=>t.username])===e.author.username&&n`<i class="ion-trash-a" onClick=${async()=>{await async function(t,a){try{await l.delete(`articles/${t}/comments/${a}`)}catch(e){throw i(e,"error while deleting comment")}}(t.articleSlug,e.id),t.onDelete()}} aria-label="Delete comment"/>`}</span></div></div>`}export default function(e){const[s,r]=t(void 0),[c,g]=t([]),[p,h]=t(""),[$,f]=t(!1),b=a(t=>t.user);return u(()=>{!async function(){f(!0),r(await m(e.slug)),g(await async function(t){try{const{data:a}=await l.get(`articles/${t}/comments`);return a.comments}catch(a){throw i(a,"error while fetching comments")}}(e.slug)),f(!1)}()},[e.slug]),s?n`<div class="article-page"><div class="banner"><div class="container"><h1>${s.title}</h1><${w} article=${s}/></div></div><div class="container page"><div class="row article-content"><div class="col-xs-12" dangerouslySetInnerHTML=${{__html:v(s.body)}}/></div><hr/><div class="article-actions"><${w} article=${s}/></div><div class="row"><div class="col-xs-12 col-md-8 offset-md-2"><form class="card comment-form"><div class="card-block"><textarea value=${p} class="form-control" placeholder="Write a comment..." rows=${3} onInput=${t=>h(t.currentTarget.value)}/></div><div class="card-footer"><img src=${function(t){let a=void 0,e=t[0],n=1;for(;n<t.length;){const o=t[n],s=t[n+1];if(n+=2,("optionalAccess"===o||"optionalCall"===o)&&null==e)return;"access"===o||"optionalAccess"===o?(a=e,e=s(e)):"call"!==o&&"optionalCall"!==o||(e=s((...t)=>e.call(a,...t)),a=void 0)}return e}([b,"optionalAccess",t=>t.image])||o} class="comment-author-img"/><button class="btn btn-sm btn-primary" onClick=${async()=>{const t=await async function(t,a){try{const{data:e}=await l.post(`articles/${t}/comments`,{comment:{body:a}});return e.comment}catch(e){throw i(e,"error while creating comment")}}(e.slug,p);h(""),g(a=>[t,...a])}}>Post Comment</button></div></form>${c.map(t=>n`<${y} key=${t.id} articleSlug=${e.slug} comment=${t} onDelete=${()=>g(a=>a.filter(a=>a.id!==t.id))}/>`)}</div></div></div></div>`:n`<${d} show=${$} style=${{margin:"1rem auto",display:"flex"}} width="2rem"/>`}